---
title: "Combine Patch Data, add fire data, remove scanline fires"
author: "Anna Talucci"
date: "9/20/2021"
output: html_document
---

# Clear workspace

```{r}
rm(list=ls()) 
```

# Overview

# Fires with Scanline Errors
```{r}
target = c(351, 361, 403, 422, 428, 434, 439, 498, 544, 550, 598, 636, 808, 892, 944, 1097, 1190, 1275, 1363, 1416, 1742, 1773, 2135, 2216, 2295,2322, 2346, 2350, 2351, 2358, 2367, 2383, 2466, 2491, 2514, 2722, 2757, 2833, 2905, 3008, 3213)
```

# Packages

```{r}
library(tidyverse)
```

# Define graph Theme and color Palette 

##Themes
```{r}
lb_theme = theme_bw() + theme(legend.position = "bottom") +  
  theme(panel.grid.major = element_blank()) +
    theme(axis.title.y = element_text(size = 11, hjust = 0.5, vjust = 1.1),
        axis.text.x = element_text(size = 10, color = "black"),
        axis.text.y = element_text(size = 10, color = "black"),
        axis.line = element_line(colour = "black"))
```

```{r}
comp_theme = theme_bw() + theme(legend.position = "none") +  
  theme(panel.grid.major = element_blank()) +
    theme(axis.title.y = element_text(size = 11, hjust = 0.5, vjust = 1.1),
        axis.text.x = element_text(size = 10, color = "black"),
        axis.text.y = element_text(size = 10, color = "black"),
        axis.line = element_line(colour = "black"))
```

```{r}
bar_theme = theme_bw() + 
  theme(legend.position = "none", legend.title = element_blank()) +
  theme(panel.grid.major = element_blank()) +
    theme(axis.title.y = element_text(size = 11, hjust = 0.5, vjust = 1.1),
        axis.text.x = element_text(size = 10, color = "black"),
        axis.text.y = element_text(size = 10, color = "black"),
        axis.line = element_line(colour = "black")) 
```

```{r}
ecoPalette <- c("#b5b35c", "#556b2f")
```


# Data

## Fire data

```{r}
fires = read.csv("../data/NESiberiaFires/NESiberiaFires2020.csv") 
```

## Class patch summaries
```{r}
data_dir <- "../data/PatchSummary/"
```

```{r eval=FALSE, include=FALSE}
fs::dir_ls(data_dir)
```

```{r}
csv_files = fs::dir_ls(data_dir, regexp = "\\.csv$")
csv_files
```


```{r}
df = csv_files %>% 
  map_dfr(read_csv)
```

# Organize Patch Class Data 
1. Filter - remove fires with scanline error
2. Pivot Wider so each patch metric is a column
```{r}
df1 = df %>% 
  filter(!IDobj %in% target) %>%
  pivot_wider(id_cols =  c(IDobj, class), names_from = metric, values_from = value)

```

```{r}
unique(df1$IDobj)
```


# Combine Fire data with Patch data

```{r}
data1 = merge(df1, fires, by = "IDobj")
```


```{r}
data2 = data1 %>% 
  mutate(LogHa = log(SizeHa))  %>%
  mutate(Logarea_mn = log(area_mn))  %>%
  dplyr::select(IDobj:class, area_mn, ca,np, enn_mn, para_mn, pd, pland, tca, SizeHa, EcoCode, ArcSub, SizeCl, LogHa, Logarea_mn) 
  
```

# Summaries patch data

Data of interest
- Mean of patch area (Area and edge metric)
- Perimeter-area ratio lsm_c_para_cv
- Percentage of landscape
- Total Core Area

Class
- 0 Burned
- 1 Unburned

Metric
1. area_mn
2. ca
3. enn (distance)
4. np
5. para (perimeter area ratio)
6. pd
7. pland
8. tca

## Tables

### Summary Means by EcoCode and Class
```{r}
data2 %>% 
  group_by(EcoCode, class) %>%
  summarise(MeanArea = mean(area_mn),
            MeanCa = mean(ca),
            MeanNp = mean(np),
            MeanEnn = mean(enn_mn),
            MeanPara = mean(para_mn),
            MeanPd=mean(pd),
            MeanPland = mean(pland),
            MeanTca = mean(tca))

```
### Summary Means by EcoCode, Class, ArcSub
```{r}
data2 %>% 
  dplyr::select(IDobj:class, area_mn, ca,np, enn_mn, para_mn, pd, pland, tca, SizeHa, EcoCode, ArcSub, SizeCl) %>%
  group_by(EcoCode, ArcSub, class) %>%
  summarise(MeanArea = mean(area_mn),
            MeanCa = mean(ca),
            MeanNp = mean(np),
            MeanEnn = mean(enn_mn),
            MeanPara = mean(para_mn),
            MeanPd=mean(pd),
            MeanPland = mean(pland),
            MeanTca = mean(tca)) %>%
   write.csv(., '../outputs/ClassPatchSummary/Table2.csv',  row.names = FALSE)

```

### Summary Means by EcoCode and Size Class
```{r}
data2 %>% 
  dplyr::select(IDobj:class, area_mn, ca,np, enn_mn, para_mn, pd, pland, tca, SizeHa, EcoCode, ArcSub, SizeCl) %>%
  group_by(EcoCode, SizeCl) %>%
  summarise(MeanArea = mean(area_mn),
            MeanCa = mean(ca),
            MeanNp = mean(np),
            MeanEnn = mean(enn_mn),
            MeanPara = mean(para_mn),
            MeanPd=mean(pd),
            MeanPland = mean(pland),
            MeanTca = mean(tca)) %>%
   write.csv(., '../outputs/ClassPatchSummary/Table3.csv',  row.names = FALSE)


```

# Graphs
```{r}
data2
```
## Graphs

```{r}
ggplot(data2, aes(x=as.factor(class), y=Logarea_mn, fill=EcoCode)) + 
    geom_boxplot() + 
   scale_fill_manual(values = ecoPalette, name="Ecozone") +
    xlab("Fire Size Class") +
      ylab("Mean percent ") +
  bar_theme +
  theme(legend.position = c(.5, .05),
        legend.key.height = unit(.1, 'in'), 
        legend.key.width = unit(.1, 'in'),
        legend.background = element_rect(fill=alpha('white', 0.0))) + 
  guides(fill = guide_legend(ncol=2), 
         shape = guide_legend(override.aes = list(size = 0.4)), 
         color = guide_legend(override.aes = list(size = 0.4))) + 
  theme(legend.text = element_text(size = 8)) 
```

```{r}
ggplot(data2, aes(x=as.factor(class), y=Logarea_mn, fill=as.factor(SizeCl))) + 
    geom_boxplot() + 
    xlab("Fire Size Class") +
      ylab("Mean percent ") +
  bar_theme +
  theme(legend.position = c(.5, .05),
        legend.key.height = unit(.1, 'in'), 
        legend.key.width = unit(.1, 'in'),
        legend.background = element_rect(fill=alpha('white', 0.0))) + 
  guides(fill = guide_legend(ncol=2), 
         shape = guide_legend(override.aes = list(size = 0.4)), 
         color = guide_legend(override.aes = list(size = 0.4))) + 
  theme(legend.text = element_text(size = 8)) 
```
**THE END**